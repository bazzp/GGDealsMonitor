<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Monitor cen gier</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<h1>Monitor cen gier</h1>
<form class="add-form" id="addForm">
  <input type="text" id="urlInput" placeholder="Wklej link do gry z GG.deals, np. https://gg.deals/game/minecraft/" required>
  <input type="number" id="thresholdInput" placeholder="Pr√≥g powiadomienia (z≈Ç)">
  <button type="submit">Dodaj</button>
</form>
<table id="gamesTable">
  <thead>
  <tr>
    <th>Nazwa gry</th>
    <th>Oficjalny sklep (z≈Ç)</th>
    <th>Keyshop (z≈Ç)</th>
    <th>Link</th>
    <th>Pr√≥g powiadomienia (z≈Ç)</th>
    <th style="width:40px;"></th>
  </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const { ipcRenderer } = require('electron');

  function updateTable(games) {
    const tbody = document.querySelector('#gamesTable tbody');
    tbody.innerHTML = '';
    games.forEach((game, i) => {
      const official = (game.official !== null && game.official !== undefined) ? game.official : '-';
      const keyshop = (game.keyshop !== null && game.keyshop !== undefined) ? game.keyshop : '-';
      const threshold = (game.threshold !== null && game.threshold !== undefined && game.threshold !== "") ? game.threshold : '-';
      const row = document.createElement('tr');
      row.innerHTML = `
          <td>${game.name}</td>
          <td>${official}</td>
          <td>${keyshop}</td>
          <td><a class="games-link" href="${game.url}" target="_blank">GG.deals</a></td>
          <td>${threshold}</td>
          <td>
            <button onclick="editThreshold(0)">
            ‚úé
            </button>
            <button data-index="${i}" class="remove-btn" title="Usu≈Ñ">
              üóëÔ∏è
            </button>
          </td>
        `;
      tbody.appendChild(row);
    });

    // Obs≈Çuga klikniƒôcia usu≈Ñ
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.onclick = function() {
        const idx = parseInt(this.getAttribute('data-index'));
        ipcRenderer.send('remove-game', idx);
      };
    });
  }

  function editThreshold(idx) {
    const current = document.getElementById('threshold-' + idx).innerText;
    const newVal = prompt("Podaj nowy pr√≥g cenowy (lub zostaw puste by wy≈ÇƒÖczyƒá):", current);
    if (newVal !== null) {
      window.electron.invoke('update-threshold', idx, newVal.trim());
    }
  }

  // Odbi√≥r zaktualizowanej listy gier
  ipcRenderer.on('games', (event, games) => {
    updateTable(games);
  });

  // Dodawanie gry
  document.getElementById('addForm').onsubmit = function(e) {
    e.preventDefault();
    const url = document.getElementById('urlInput').value.trim();
    const threshold = document.getElementById('thresholdInput').value.trim();
    if (url) {
      ipcRenderer.invoke('add-game', url, threshold);
      document.getElementById('urlInput').value = '';
      document.getElementById('thresholdInput').value = '';
    }
  };

  // Za≈Çaduj gry przy starcie
  window.onload = function() {
    ipcRenderer.send('get-games');
  };
</script>
</body>
</html>